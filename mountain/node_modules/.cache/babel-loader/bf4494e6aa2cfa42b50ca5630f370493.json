{"remainingRequest":"/Users/zzz/Desktop/mac/unit/mountain/node_modules/_babel-loader@8.0.6@babel-loader/lib/index.js!/Users/zzz/Desktop/mac/unit/mountain/node_modules/_cache-loader@2.0.1@cache-loader/dist/cjs.js??ref--0-0!/Users/zzz/Desktop/mac/unit/mountain/node_modules/_vue-loader@15.7.0@vue-loader/lib/index.js??vue-loader-options!/Users/zzz/Desktop/mac/unit/mountain/src/views/article.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/zzz/Desktop/mac/unit/mountain/src/views/article.vue","mtime":1562314863908},{"path":"/Users/zzz/Desktop/mac/unit/mountain/node_modules/_cache-loader@2.0.1@cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/zzz/Desktop/mac/unit/mountain/node_modules/_babel-loader@8.0.6@babel-loader/lib/index.js","mtime":499162500000},{"path":"/Users/zzz/Desktop/mac/unit/mountain/node_modules/_cache-loader@2.0.1@cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/zzz/Desktop/mac/unit/mountain/node_modules/_vue-loader@15.7.0@vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["import \"core-js/modules/es6.regexp.match\";\nimport \"core-js/modules/es6.regexp.split\";\nimport \"core-js/modules/es6.number.constructor\";\nimport \"core-js/modules/es6.number.parse-int\";\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\n/**\n * 文章: 添加, 列表, 编辑, 删除\n * 七牛token\n */\nimport { articlesadd, articleslist, articlesedit, articlesdelete, qiniutoken } from \"../api\";\nimport utils from \"../utils/index\";\nimport moment from 'moment';\nexport default {\n  name: '',\n  data: function data() {\n    var _this = this;\n\n    return {\n      loading: false,\n      preview: false,\n      //  预览\n      editorOption: {\n        //  编辑器配置\n        placeholder: '移动端将选取第一张图作为封面图(宽高比例 1.3 : 1)',\n        theme: 'snow',\n        modules: {\n          toolbar: {\n            container: utils.toolbarOptions,\n            handlers: {\n              'image': function image(value) {\n                if (value) {\n                  document.querySelector('.upload-demo input').click();\n                } else {\n                  _this.quill.format('image', false);\n                }\n              }\n            }\n          }\n        }\n      },\n      show: '',\n      //  默认显示列表\n      currentSetStatus: '',\n      //  当前的操作状态\n      list: {\n        //  用户信息\n        data: [],\n        //  数据\n        total: 0 //  总数\n\n      },\n      para: {\n        //  查询条件\n        pageIndex: 1,\n        pageSize: 10\n      },\n      form: {\n        title: '',\n        content: \"\"\n      },\n      fileList: {\n        articles: []\n      },\n      qiniu: {\n        //  七牛上传\n        token: '',\n        key: '',\n        uploadUrl: '' //  上传地址前缀\n\n      }\n    };\n  },\n  computed: {},\n  mounted: function mounted() {\n    this.show = 'list';\n    this.getarticleslist();\n    this.getqiniutoken();\n  },\n  methods: {\n    getqiniutoken: function getqiniutoken() {\n      var _this2 = this;\n\n      //  拿到七牛的token\n      var para = {\n        bucket: 'huaxiaohong'\n      };\n      qiniutoken(para).then(function (res) {\n        console.log(res);\n        var _res$data = res.data,\n            code = _res$data.code,\n            data = _res$data.data,\n            msg = _res$data.msg;\n\n        if (code === 200) {\n          _this2.qiniu.token = data.token;\n          _this2.qiniu.uploadUrl = data.url;\n        } else {\n          _this2.$message(msg);\n        }\n      });\n    },\n    handleBeforeUpload: function handleBeforeUpload(file, type) {\n      //  上传之前\n      this.loading = true;\n      this.qiniu.key = \"\" + type + \"\".concat(moment().format('YYYYMMDDHHmmSSS')).concat(Number.parseInt(Math.random() * 1000, 10), \".\").concat(file.type.split('/')[1]);\n    },\n    handleOnSuccess: function handleOnSuccess(response, file, fileList, type) {\n      //  上传成功之后\n      var url = this.qiniu.uploadUrl + '/' + response.key; //  获取富文本组件实例\n\n      var quill = this.$refs.myQuillEditor.quill;\n\n      if (response) {\n        // 获取光标所在位置\n        this.loading = false;\n        var length = quill.getSelection().index; // 插入图片  res.info为服务器返回的图片地址\n\n        quill.insertEmbed(length, 'image', url); // 调整光标到最后\n\n        quill.setSelection(length + 1);\n      } else {\n        this.$message.error('error');\n      }\n    },\n    handleOnRemove: function handleOnRemove(file, fileList, type) {\n      //  删除\n      console.log(file, fileList);\n    },\n    handleSearch: function handleSearch(obj, val) {\n      //  查询数据列表 obj: 对象, val: 值\n      switch (obj) {\n        case 'pagination':\n          //  分页\n          this.para.pageIndex = val;\n          this.getarticleslist();\n          break;\n      }\n    },\n    handleOnChange: function handleOnChange(file, fileList, type) {\n      //  图片本地预览\n      console.log(file, fileList);\n      this.getUrl(file.raw);\n    },\n    submitUpload: function submitUpload() {\n      this.$refs.upload.submit();\n    },\n    getUrl: function getUrl(files) {\n      //  图片本地预览\n      var reader = new FileReader();\n      reader.readAsDataURL(files); // 这里是最关键的一步，转换就在这里\n\n      var quill = this.$refs.myQuillEditor.quill;\n\n      reader.onloadend = function () {\n        console.log(this.result);\n\n        if (this.result) {\n          // 获取光标所在位置\n          var length = quill.getSelection().index; // 插入图片  res.info为服务器返回的图片地址\n\n          quill.insertEmbed(length, 'image', this.result); // 调整光标到最后\n\n          quill.setSelection(length + 1);\n        } else {\n          this.$message.error('error');\n        }\n      };\n    },\n    getarticleslist: function getarticleslist() {\n      var _this3 = this;\n\n      //  查询列表\n      articleslist(this.para).then(function (res) {\n        console.log(res);\n        var _res$data2 = res.data,\n            code = _res$data2.code,\n            msg = _res$data2.msg,\n            data = _res$data2.data,\n            total = _res$data2.total;\n\n        if (code !== 200) {\n          _this3.$message.error(msg);\n        } else {\n          _this3.list.data = data;\n          _this3.list.total = total;\n        }\n      });\n    },\n    handleSet: function handleSet(obj, row) {\n      var _this4 = this;\n\n      //  根据不同状态处理对应事件\n      console.log(obj, row);\n      this.show = obj;\n\n      switch (obj) {\n        case 'add':\n          this.form = {};\n          this.currentSetStatus = 'add';\n          break;\n\n        case 'back':\n          this.show = 'list'; //  显示列表界面\n\n          this.preview = false; //  隐藏预览界面\n\n          break;\n\n        case 'backedit':\n          this.preview = false;\n          this.show = 'add';\n          break;\n\n        case 'preview':\n          this.$refs.content.innerHTML = this.form.content;\n          this.preview = true;\n          break;\n\n        case 'info':\n          this.form = row;\n          this.$refs.content.innerHTML = this.form.content;\n          this.preview = true;\n          break;\n\n        case 'edit':\n          this.form = row;\n          this.currentSetStatus = 'edit';\n          break;\n\n        case 'delete':\n          this.show = 'list';\n          this.$confirm('此操作将删除该数据是否继续?', '提示', {\n            confirmButtonText: '继续',\n            cancelButtonText: '取消',\n            type: 'danger'\n          }).then(function () {\n            _this4.form._id = row._id;\n            var para = new URLSearchParams(_this4.form);\n            articlesdelete(para).then(function (res) {\n              var code = res.code,\n                  msg = res.msg;\n\n              if (code === 200) {\n                _this4.$message.success(msg);\n\n                _this4.getarticleslist();\n              } else {\n                _this4.$message.error(msg);\n              }\n            });\n          }).catch(function () {\n            _this4.$message.info('已取消');\n          });\n          break;\n      }\n    },\n    handleSubmit: function handleSubmit() {\n      var _this5 = this;\n\n      //  发布文章\n      if (this.form.title === '' || !this.form.title) {\n        this.$message.error('标题不能为空');\n      } else {\n        this.form.author = sessionStorage.getItem('user');\n        this.form.uid = sessionStorage.getItem('uid');\n        this.form.date = utils.formatterTime(new Date());\n        this.form.cover = this.form.content.match(/(http[^\">]*)/g)[0];\n        console.log(this.form);\n        var para = new URLSearchParams(this.form);\n        var a;\n\n        if (this.currentSetStatus === 'add') {\n          a = articlesadd(para);\n        } else {\n          a = articlesedit(para);\n        }\n\n        a.then(function (res) {\n          console.log(res);\n          var code = res.code,\n              msg = res.msg;\n\n          if (code === 200) {\n            _this5.getarticleslist();\n\n            _this5.show = 'list';\n            _this5.preview = false;\n\n            _this5.$message.success(msg);\n          } else {\n            _this5.$message.error(msg);\n          }\n        });\n      }\n    }\n  }\n};",{"version":3,"sources":["article.vue"],"names":[],"mappings":"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","sourcesContent":["<template>\n  <div id=\"articles\">\n    <div v-show=\"!preview\">\n      <template v-if=\"show === 'list'\">\n        <div class=\"txtright marginbtm30\">\n          <el-button type=\"info\" @click=\"handleSet('add', {})\">发布文章</el-button>\n        </div>\n        <el-table\n          :data=\"list.data\"\n          style=\"width: 100%\">\n\n          <el-table-column label=\"标题\">\n            <template slot-scope=\"scope\">{{ scope.row.title }}</template>\n          </el-table-column>\n\n          <el-table-column label=\"作者\">\n            <template slot-scope=\"scope\">{{ scope.row.author }}</template>\n          </el-table-column>\n\n          <el-table-column label=\"日期\">\n            <template slot-scope=\"scope\">{{ scope.row.date }}</template>\n          </el-table-column>\n\n          <el-table-column label=\"喜欢\">\n            <template slot-scope=\"scope\">{{ scope.row.likes }}</template>\n          </el-table-column>\n\n          <el-table-column label=\"评分\">\n            <template slot-scope=\"scope\">{{ scope.row.score }}</template>\n          </el-table-column>\n\n          <el-table-column label=\"操作\" min-width=\"90\">\n            <template slot-scope=\"scope\">\n              <el-button\n                size=\"mini\"\n                type=\"error\"\n                @click=\"handleSet('info', scope.row)\">查看</el-button>\n              <el-button\n                size=\"mini\"\n                type=\"primary\"\n                @click=\"handleSet('edit', scope.row)\">编辑</el-button>\n              <el-button\n                size=\"mini\"\n                type=\"danger\"\n                @click=\"handleSet('delete', scope.row)\">删除</el-button>\n            </template>\n          </el-table-column>\n        </el-table>\n        <div class=\"txtcenter\">\n          <el-pagination\n            background\n            layout=\"total, prev, pager, next\"\n            @current-change=\"(value) => {return handleSearch('pagination', value)}\"\n            :current-page=\"para.pageIndex\"\n            :total=\"list.total\">\n          </el-pagination>\n        </div>\n      </template>\n\n      \n      <template v-if=\"show !== 'list'\" v-loading=\"loading\">\n        <div class=\"articles__btn\">\n          <el-button type=\"info\" @click=\"handleSet('back', null)\" >返回</el-button>\n          <el-button type=\"error\" @click=\"handleSet('preview', {})\">预览</el-button>\n          <el-button type=\"success\" @click=\"handleSubmit\" >发布</el-button>\n        </div>\n        <div class=\"articles__title\">\n          <el-input ref=\"myinput\" placeholder=\"请输入标题\" v-model=\"form.title \" clearable></el-input>\n        </div>\n        <quill-editor \n          v-model=\"form.content\"\n          ref=\"myQuillEditor\"\n          :options=\"editorOption\"\n        >\n        </quill-editor>\n      </template>\n\n    </div>\n\n    <!-- :on-change=\"(file, fileList) => { return handleOnChange(file, fileList, 'articles') }\" -->\n    <div v-show=\"false\">\n      <el-upload\n        class=\"upload-demo\"\n        :data=\"qiniu\"\n        ref=\"upload\"\n        action=\"https://upload-z2.qiniup.com\"\n        :show-file-list=\"true\"\n        :multiple=\"false\"\n        :file-list=\"fileList.articles\"\n        :auto-upload=\"true\"\n        :before-upload=\"(file) => {return handleBeforeUpload(file, 'articles')}\"\n        :on-success=\"(response, file, fileList) => { return handleOnSuccess(response, file, fileList, 'articles') }\"\n        :on-remove=\"(file, fileList) => { return handleOnRemove(file, fileList, 'articles') }\"\n      >\n        <el-button size=\"small\" type=\"primary\">点击上传</el-button>\n      </el-upload>\n      <el-button style=\"margin-left: 10px;\" size=\"small\" type=\"success\" @click=\"submitUpload\">上传到服务器</el-button>\n    </div>\n\n\n    <div v-show=\"preview\">\n      <div class=\"articles__btn\">\n        <el-button type=\"info\" v-if=\"show === 'info'\" @click=\"handleSet('back', null)\" >返回</el-button>\n        <el-button type=\"info\" v-if=\"show === 'preview'\" @click=\"handleSet('backedit', null)\" >返回</el-button>\n        <el-button type=\"success\" v-if=\"show === 'preview'\" @click=\"handleSubmit\" >发布</el-button>\n      </div>\n      <div class=\"articles\">\n        <div class=\"articles__title\">{{ form.title }}</div>\n        <div class=\"articles__info\">\n          <span>作者: {{ form.author }}</span>\n          <span>时间: {{ form.date }}</span>\n        </div>\n        <div class=\"articles__content\" ref=\"content\"></div>\n      </div>\n    </div>\n  </div>\n</template>\n\n<script>\n/**\n * 文章: 添加, 列表, 编辑, 删除\n * 七牛token\n */\nimport { \n  articlesadd, articleslist, articlesedit, articlesdelete, \n  qiniutoken\n} from '../api'\nimport utils from '../utils/index'\nimport moment from 'moment'\nexport default {\n  name: '',\n  data () {\n    return {\n      loading: false,\n      preview: false, //  预览\n      editorOption: { //  编辑器配置\n        placeholder: '移动端将选取第一张图作为封面图(宽高比例 1.3 : 1)',\n        theme: 'snow',\n        modules: {\n          toolbar: {\n            container: utils.toolbarOptions,\n            handlers: {\n              'image': value => {\n                if (value) {\n                  document.querySelector('.upload-demo input').click()\n                } else {\n                  this.quill.format('image', false)\n                }\n              }\n            }\n          }\n        }\n      },\n      show: '', //  默认显示列表\n      currentSetStatus: '', //  当前的操作状态\n      list: { //  用户信息\n        data: [], //  数据\n        total: 0 //  总数\n      },\n      para: { //  查询条件\n        pageIndex: 1,\n        pageSize: 10,\n      },\n      form: {\n        title: '',\n        content: ``\n      },\n      fileList: {\n        articles: []\n      },\n      qiniu: { //  七牛上传\n        token: '',\n        key: '',\n        uploadUrl: '', //  上传地址前缀\n      },\n    }\n  },\n  computed: {\n  },\n  mounted() {\n    this.show = 'list'\n    this.getarticleslist()\n    this.getqiniutoken()\n  },\n  methods: {\n    getqiniutoken () { //  拿到七牛的token\n      let para = {\n        bucket: 'huaxiaohong'\n      }\n      qiniutoken(para).then(res => {\n        console.log(res)\n        let { code, data, msg } = res.data\n        if (code === 200) {\n          this.qiniu.token = data.token\n          this.qiniu.uploadUrl = data.url\n        } else {\n          this.$message(msg)\n        }\n      })\n    },\n    handleBeforeUpload (file, type) { //  上传之前\n      this.loading = true\n      this.qiniu.key = ``+ type +`${moment().format('YYYYMMDDHHmmSSS')}${Number.parseInt(Math.random() * 1000, 10)}.${file.type.split('/')[1]}`\n    },\n    handleOnSuccess (response, file, fileList, type) { //  上传成功之后\n      let url = this.qiniu.uploadUrl + '/' + response.key\n      //  获取富文本组件实例\n      let quill = this.$refs.myQuillEditor.quill\n      if (response) {\n        // 获取光标所在位置\n        this.loading = false\n        let length = quill.getSelection().index\n        // 插入图片  res.info为服务器返回的图片地址\n        quill.insertEmbed(length, 'image', url)\n        // 调整光标到最后\n        quill.setSelection(length + 1)\n      } else {\n        this.$message.error('error')\n      }\n    },\n    handleOnRemove (file, fileList, type) { //  删除\n      console.log(file, fileList)\n    },\n    handleSearch (obj, val) { //  查询数据列表 obj: 对象, val: 值\n      switch (obj) {\n        case 'pagination': //  分页\n          this.para.pageIndex = val\n          this.getarticleslist()\n          break\n      }\n    },\n    handleOnChange (file, fileList, type) { //  图片本地预览\n      console.log(file, fileList)\n      this.getUrl(file.raw)\n    },\n    submitUpload() {\n      this.$refs.upload.submit()\n    },\n    getUrl (files) { //  图片本地预览\n      let reader = new FileReader()\n      reader.readAsDataURL(files) // 这里是最关键的一步，转换就在这里\n      let quill = this.$refs.myQuillEditor.quill\n      reader.onloadend = function () {\n         console.log(this.result)\n        if (this.result) {\n          // 获取光标所在位置\n          let length = quill.getSelection().index\n          // 插入图片  res.info为服务器返回的图片地址\n          quill.insertEmbed(length, 'image', this.result)\n          // 调整光标到最后\n          quill.setSelection(length + 1)\n        } else {\n          this.$message.error('error')\n        }\n      }\n    },\n    getarticleslist () { //  查询列表\n      articleslist(this.para).then(res => {\n        console.log(res)\n        let { code, msg, data, total } = res.data\n        if (code !== 200) {\n          this.$message.error(msg)\n        } else {\n          this.list.data = data\n          this.list.total = total\n        }\n      })\n    },\n    handleSet (obj, row) { //  根据不同状态处理对应事件\n      console.log(obj, row)\n      this.show = obj\n      switch (obj) {\n        case 'add':\n          this.form = {}\n          this.currentSetStatus = 'add'\n          break\n        case 'back':\n          this.show = 'list' //  显示列表界面\n          this.preview = false //  隐藏预览界面\n          break\n        case 'backedit':\n          this.preview = false\n          this.show = 'add'\n          break\n        case 'preview':\n          this.$refs.content.innerHTML = this.form.content\n          this.preview = true\n          break\n        case 'info':\n          this.form = row\n          this.$refs.content.innerHTML = this.form.content\n          this.preview = true\n          break\n        case 'edit':\n          this.form = row\n          this.currentSetStatus = 'edit'\n          break\n        case 'delete':\n          this.show = 'list'\n          this.$confirm('此操作将删除该数据是否继续?', '提示', {\n            confirmButtonText: '继续',\n            cancelButtonText: '取消',\n            type: 'danger'\n          }).then(() => {\n            this.form._id = row._id\n            let para = new URLSearchParams(this.form)\n            articlesdelete(para).then(res => {\n              let { code, msg } = res\n              if (code === 200) {\n                this.$message.success(msg)\n                this.getarticleslist()\n              } else {\n                this.$message.error(msg)\n              }\n            })\n          }).catch(() => {\n            this.$message.info('已取消')\n          })\n          break\n      }\n    },\n    handleSubmit () { //  发布文章\n      if (this.form.title === '' || !this.form.title) {\n        this.$message.error('标题不能为空')\n      } else {\n        this.form.author = sessionStorage.getItem('user')\n        this.form.uid = sessionStorage.getItem('uid')\n        this.form.date = utils.formatterTime(new Date())\n        this.form.cover = this.form.content.match(/(http[^\">]*)/g)[0]\n        console.log(this.form)\n        let para = new URLSearchParams(this.form)\n        let a\n        if (this.currentSetStatus === 'add') {\n          a = articlesadd(para)\n        } else {\n          a = articlesedit(para)\n        }\n        a.then(res => {\n          console.log(res)\n          let { code, msg } = res\n          if (code === 200) {\n            this.getarticleslist()\n            this.show = 'list'\n            this.preview = false\n            this.$message.success(msg)\n          } else {\n            this.$message.error(msg)\n          }\n        })\n      }\n    }\n  },\n}\n</script>\n<style lang=\"stylus\">\n#articles {\n  .articles__btn {\n    text-align right \n    margin-bottom 20px\n  }\n  .articles__title {\n    margin 20px 0\n    font-size 20px\n  }\n  .ql-container {\n    height 800px\n  }\n  .articles {\n    &__title {\n      font-size 24px\n      text-align center\n    }\n    &__info {\n      text-align right\n      font-size 16px\n      color #888\n      span {\n        display inline-block\n        margin 0 8px\n      }\n    }\n    &__content {\n      margin-top 20px\n      text-indent 2em\n    }\n  }\n}\n</style>\n\n"],"sourceRoot":"src/views"}]}