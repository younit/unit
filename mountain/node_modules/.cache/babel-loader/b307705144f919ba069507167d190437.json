{"remainingRequest":"/Users/zzz/Desktop/mac/unit/mountain/node_modules/_babel-loader@8.0.6@babel-loader/lib/index.js!/Users/zzz/Desktop/mac/unit/mountain/node_modules/_cache-loader@2.0.1@cache-loader/dist/cjs.js??ref--0-0!/Users/zzz/Desktop/mac/unit/mountain/node_modules/_vue-loader@15.7.0@vue-loader/lib/index.js??vue-loader-options!/Users/zzz/Desktop/mac/unit/mountain/src/views/task.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/zzz/Desktop/mac/unit/mountain/src/views/task.vue","mtime":1565944813498},{"path":"/Users/zzz/Desktop/mac/unit/mountain/node_modules/_cache-loader@2.0.1@cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/zzz/Desktop/mac/unit/mountain/node_modules/_babel-loader@8.0.6@babel-loader/lib/index.js","mtime":499162500000},{"path":"/Users/zzz/Desktop/mac/unit/mountain/node_modules/_cache-loader@2.0.1@cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/zzz/Desktop/mac/unit/mountain/node_modules/_vue-loader@15.7.0@vue-loader/lib/index.js","mtime":499162500000},{"path":"/Users/zzz/Desktop/mac/unit/mountain/node_modules/_cache-loader@2.0.1@cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/zzz/Desktop/mac/unit/mountain/node_modules/_babel-loader@8.0.6@babel-loader/lib/index.js","mtime":499162500000},{"path":"/Users/zzz/Desktop/mac/unit/mountain/node_modules/_cache-loader@2.0.1@cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/zzz/Desktop/mac/unit/mountain/node_modules/_vue-loader@15.7.0@vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport { task, taskadd, qiniuupload, taskdelete } from \"../api\";\nimport utils from \"../utils/index\";\nexport default {\n  name: 'task',\n  data: function data() {\n    return {\n      form: {},\n      //  表单\n      imageUrl: '',\n      //  预览图\n      currentSetSts: '',\n      //  当前操作状态\n      previewImg: '',\n      para: {\n        pageIndex: 1,\n        pageSize: 10\n      },\n      list: {\n        //  用户信息\n        data: [],\n        //  数据\n        total: 0 //  总数\n\n      },\n      dialogCfg: {\n        //  弹出框配置\n        title: '',\n        //  标题\n        dialogVisible: false,\n        //  显示隐藏弹出框\n        width: '30%',\n        //  宽度\n        center: true,\n        //  是否居中\n        fullscreen: false //  是否全屏\n\n      },\n      rules: {\n        //  规则\n        width: '100px',\n        name: [{\n          required: true,\n          message: '必填项',\n          trigger: 'blur',\n          type: 'string'\n        }],\n        score: [{\n          required: true,\n          message: '必填项',\n          trigger: 'blur'\n        }, {\n          type: 'number',\n          message: '必须为数字值'\n        }],\n        img: [{\n          required: true,\n          message: '必填项',\n          trigger: 'change'\n        }]\n      },\n      fullscreenLoading: false,\n      isuploadImg: false\n    };\n  },\n  mounted: function mounted() {\n    this.getlist();\n  },\n  methods: {\n    handleSearch: function handleSearch(obj, val) {\n      //  查询数据列表 obj: 对象, val: 值\n      switch (obj) {\n        case 'pagination':\n          //  分页\n          this.para.pageIndex = val;\n          this.getlist();\n          break;\n      }\n    },\n    getlist: function getlist() {\n      var _this2 = this;\n\n      task(this.para).then(function (res) {\n        console.log(res);\n        var _res$data = res.data,\n            code = _res$data.code,\n            msg = _res$data.msg,\n            data = _res$data.data,\n            total = _res$data.total;\n\n        if (code !== 200) {\n          _this2.$message.error(msg);\n        } else {\n          _this2.list.data = data;\n          _this2.list.total = total;\n        }\n      });\n    },\n    handleSet: function handleSet(obj, row) {\n      var _this3 = this;\n\n      console.log(obj, row);\n      this.currentSetSts = obj; //  设置当前操作状态\n\n      switch (obj) {\n        case 'add':\n          //  添加\n          this.dialogCfg.title = '添加';\n          this.dialogCfg.width = '30%';\n          this.form = {};\n          this.imageUrl = '';\n          this.dialogCfg.dialogVisible = true;\n          break;\n\n        case 'edit':\n          //  编辑\n          this.dialogCfg.title = '编辑';\n          this.dialogCfg.width = '30%';\n          this.form = row;\n          this.form._id = row._id;\n          this.imageUrl = row.img;\n          this.isuploadImg = false;\n          this.dialogCfg.dialogVisible = true;\n          break;\n\n        case 'preview':\n          //  预览图片\n          if (row) {\n            this.dialogCfg.title = '预览';\n            this.previewImg = row;\n            this.dialogCfg.dialogVisible = true;\n          }\n\n          break;\n\n        case 'delete':\n          this.$confirm('此操作将删除该数据是否继续?', '提示', {\n            confirmButtonText: '继续',\n            cancelButtonText: '取消',\n            type: 'danger'\n          }).then(function () {\n            _this3.form._id = row._id;\n            var para = new URLSearchParams(_this3.form);\n            _this3.fullscreenLoading = true;\n            taskdelete(para).then(function (res) {\n              var code = res.code,\n                  msg = res.msg;\n\n              if (code === 200) {\n                _this3.fullscreenLoading = false;\n\n                _this3.$message.success(msg);\n\n                _this3.getlist();\n              } else {\n                _this3.fullscreenLoading = false;\n\n                _this3.$message.error(msg);\n              }\n            });\n          }).catch(function () {\n            _this3.$message.info('已取消');\n          });\n          break;\n      }\n    },\n    handleSuccess: function handleSuccess() {\n      var _this4 = this;\n\n      var _this = this;\n\n      console.log(this.currentSetSts);\n\n      switch (this.currentSetSts) {\n        case 'add':\n        case 'edit':\n          //  添加\n          console.log(_this.form);\n          this.$refs.form.validate(function (valid) {\n            if (valid) {\n              _this4.fullscreenLoading = true;\n\n              if (_this4.isuploadImg === false) {\n                //  判断是否重新上传了图片\n                _this4.postadd();\n              } else {\n                var para = new URLSearchParams(_this.form);\n                qiniuupload(para).then(function (res) {\n                  console.log(res);\n                  var code = res.code,\n                      data = res.data,\n                      url = res.url;\n\n                  if (code === 200) {\n                    _this4.form.img = '';\n                    var key = data.key,\n                        hash = data.hash;\n                    console.log(key, hash);\n                    _this.form.img = url + key;\n\n                    _this4.postadd();\n                  }\n                });\n              }\n            } else {\n              _this4.$message.error('请填写完整');\n\n              return false;\n            }\n          });\n          break;\n\n        case 'preview':\n          this.dialogCfg.dialogVisible = false;\n          break;\n      }\n    },\n    handleChange: function handleChange(file) {\n      var _this = this;\n\n      this.imageUrl = URL.createObjectURL(file.raw); // 图片预览\n\n      var reader = new FileReader(); //  生成文件读取\n\n      reader.readAsDataURL(file.raw); //  转化文件数据流链接\n\n      reader.onload = function () {\n        _this.isuploadImg = true;\n        _this.form.img = reader.result; //  拿到base64结果\n      };\n    },\n    postadd: function postadd() {\n      var _this5 = this;\n\n      if (this.form._id) {//  编辑\n      } else {\n        this.form.createDate = new Date().getTime();\n      }\n\n      this.form.updateTime = new Date().getTime();\n      var para = new URLSearchParams(this.form);\n      taskadd(para).then(function (res) {\n        console.log(res);\n        var code = res.code,\n            msg = res.msg;\n\n        if (code === 200) {\n          _this5.fullscreenLoading = false;\n\n          _this5.$message.success(msg);\n\n          _this5.getlist();\n\n          _this5.dialogCfg.dialogVisible = false; // this.$confirm('添加成功,是否继续添加?', '提示', {\n          //   confirmButtonText: '继续',\n          //   cancelButtonText: '取消',\n          //   type: 'primary'\n          // }).then(() => {\n          //   this.form.name = ''\n          // }).catch(() => {\n          //   this.$message.success(msg)\n          //   this.getlist()\n          //   this.dialogCfg.dialogVisible = false\n          // })\n        } else {\n          _this5.fullscreenLoading = false;\n\n          _this5.$message.error(msg);\n        }\n      });\n    },\n    getTime: function getTime(time) {\n      if (time) {\n        return utils.formatterTime(parseInt(time));\n      }\n\n      return '';\n    }\n  }\n};",{"version":3,"sources":["task.vue"],"names":[],"mappings":"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","sourcesContent":["<template>\n  <div>\n     <template>\n\n      <div class=\"txtright marginbtm30\">\n        <el-button type=\"info\" @click=\"handleSet('add', {})\">创建任务</el-button>\n      </div>\n      <el-table\n        :data=\"list.data\"\n        style=\"width: 100%\">\n\n        <el-table-column label=\"名称\">\n          <template slot-scope=\"scope\">{{ scope.row.name }}</template>\n        </el-table-column>\n\n        <el-table-column label=\"封面\">\n          <template slot-scope=\"scope\"><img v-if=\"scope.row.img\" :src=\"scope.row.img\" class=\"headimg\" @click=\"handleSet('preview', scope.row.img)\"></template>\n        </el-table-column>\n\n        <el-table-column label=\"描述\">\n          <template slot-scope=\"scope\">{{ scope.row.desc }}</template>\n        </el-table-column>\n\n        <el-table-column label=\"积分\">\n          <template slot-scope=\"scope\">{{ scope.row.score }}</template>\n        </el-table-column>\n\n        <el-table-column label=\"数量\">\n          <template slot-scope=\"scope\">{{ scope.row.surplus }}</template>\n        </el-table-column>\n\n        <el-table-column label=\"创建时间\">\n          <template slot-scope=\"scope\">{{ getTime(scope.row.createDate) }}</template>\n        </el-table-column>\n\n        <el-table-column label=\"更新时间\">\n          <template slot-scope=\"scope\">{{ getTime(scope.row.updateTime) }}</template>\n        </el-table-column>\n        \n        <el-table-column label=\"操作\" min-width=\"90\">\n          <template slot-scope=\"scope\">\n            <el-button\n              size=\"mini\"\n              type=\"primary\"\n              @click=\"handleSet('edit', scope.row)\">编辑</el-button>\n            <el-button\n              size=\"mini\"\n              type=\"danger\"\n              @click=\"handleSet('delete', scope.row)\">删除</el-button>\n          </template>\n        </el-table-column>\n      </el-table>\n      <div class=\"txtcenter\">\n        <el-pagination\n          background\n          layout=\"total, prev, pager, next\"\n          @current-change=\"(value) => {return handleSearch('pagination', value)}\"\n          :current-page=\"para.pageIndex\"\n          :total=\"list.total\">\n        </el-pagination>\n      </div>\n    </template>\n\n    <el-dialog\n      :title=\"dialogCfg.title\"\n      :visible.sync=\"dialogCfg.dialogVisible\"\n      :width=\"dialogCfg.width\"\n      :center=\"dialogCfg.center\"\n      :fullscreen=\"dialogCfg.fullscreen\"\n      >\n      <template  v-if=\"currentSetSts === 'preview'\">\n        <img :src=\"previewImg\" alt=\"\" class=\"previewImg\">\n      </template>\n      <template v-if=\"currentSetSts !== 'preview'\">\n        <el-form :model=\"form\" ref=\"form\" :rules=\"rules\" :label-width=\"rules.width\" class=\"formStyle\">\n\n          <el-form-item label=\"名称\" prop=\"name\" :label-width=\"rules.width\">\n            <el-input v-model=\"form.name\" clearable></el-input>\n          </el-form-item>\n\n          <el-form-item label=\"积分\" prop=\"score\" :label-width=\"rules.width\">\n            <el-input v-model.number=\"form.score\"></el-input>\n          </el-form-item>\n\n          <el-form-item label=\"商品封面\" prop=\"img\" :label-width=\"rules.width\">\n          <el-upload\n            class=\"avatar-uploader\"\n            ref=\"upload\"\n            action=\"https://upload-z2.qiniup.com\"\n            :show-file-list=\"false\"\n            :auto-upload=\"false\"\n            :on-change=\"handleChange\"\n          >\n            <img v-if=\"imageUrl\" :src=\"imageUrl\" class=\"avatar\">\n            <i v-else class=\"el-icon-plus avatar-uploader-icon\"></i>\n          </el-upload>\n          </el-form-item>\n\n          <el-form-item label=\"任务数量\" :label-width=\"rules.width\">\n            <el-input v-model=\"form.surplus\" clearable></el-input>\n          </el-form-item>\n\n          <el-form-item label=\"任务说明\" :label-width=\"rules.width\">\n            <el-input v-model=\"form.desc\" clearable></el-input>\n          </el-form-item>\n\n        </el-form>\n      </template>\n      \n\n      <span slot=\"footer\" class=\"dialog-footer\">\n        <el-button @click=\"dialogCfg.dialogVisible = false\">取 消</el-button>\n        <el-button type=\"primary\" @click=\"handleSuccess()\" v-loading.fullscreen.lock=\"fullscreenLoading\">确 定</el-button>\n      </span>\n    </el-dialog>\n\n  </div>\n</template>\n\n<script>\nimport { task, taskadd, qiniuupload, taskdelete } from '../api'\nimport utils from '../utils/index'\nexport default {\n  name: 'task',\n  data () {\n    return {\n      form: {}, //  表单\n      imageUrl: '', //  预览图\n      currentSetSts: '', //  当前操作状态\n      previewImg: '',\n      para: {\n        pageIndex: 1,\n        pageSize: 10,\n      },\n      list: { //  用户信息\n        data: [], //  数据\n        total: 0 //  总数\n      },\n      dialogCfg: { //  弹出框配置\n        title: '', //  标题\n        dialogVisible: false, //  显示隐藏弹出框\n        width: '30%', //  宽度\n        center: true, //  是否居中\n        fullscreen: false, //  是否全屏\n      },\n      rules: { //  规则\n        width: '100px',\n        name: [{ required: true, message: '必填项', trigger: 'blur', type: 'string' },],\n        score: [{ required: true, message: '必填项', trigger: 'blur' }, { type: 'number', message: '必须为数字值'}],\n        img: [{ required: true, message: '必填项', trigger: 'change' }],\n      },\n      fullscreenLoading: false,\n      isuploadImg: false\n    }\n  },\n  mounted() {\n    this.getlist()\n  },\n  methods: {\n    handleSearch (obj, val) { //  查询数据列表 obj: 对象, val: 值\n      switch (obj) {\n        case 'pagination': //  分页\n          this.para.pageIndex = val\n          this.getlist()\n          break\n      }\n    },\n    getlist () {\n      task(this.para).then(res => {\n        console.log(res)\n        let { code, msg, data, total } = res.data\n        if (code !== 200) {\n          this.$message.error(msg)\n        } else {\n          this.list.data = data\n          this.list.total = total\n        }\n      })\n    },\n    handleSet (obj, row) {\n      console.log(obj, row)\n      this.currentSetSts = obj //  设置当前操作状态\n      switch (obj) {\n        case 'add': //  添加\n          this.dialogCfg.title = '添加'\n          this.dialogCfg.width = '30%'\n          this.form = {}\n          this.imageUrl = ''\n          this.dialogCfg.dialogVisible = true\n          break\n        case 'edit': //  编辑\n          this.dialogCfg.title = '编辑'\n          this.dialogCfg.width = '30%'\n          this.form = row\n          this.form._id = row._id\n          this.imageUrl = row.img\n          this.isuploadImg = false\n          this.dialogCfg.dialogVisible = true\n          break\n        case 'preview': //  预览图片\n          if (row) {\n            this.dialogCfg.title = '预览'\n            this.previewImg = row\n            this.dialogCfg.dialogVisible = true\n          }\n          break\n        case 'delete':\n          this.$confirm('此操作将删除该数据是否继续?', '提示', {\n            confirmButtonText: '继续',\n            cancelButtonText: '取消',\n            type: 'danger'\n          }).then(() => {\n            this.form._id = row._id\n            let para = new URLSearchParams(this.form)\n            this.fullscreenLoading = true\n            taskdelete(para).then(res => {\n              let { code, msg } = res\n              if (code === 200) {\n                this.fullscreenLoading = false\n                this.$message.success(msg)\n                this.getlist()\n              } else {\n                this.fullscreenLoading = false\n                this.$message.error(msg)\n              }\n            })\n          }).catch(() => {\n            this.$message.info('已取消')\n          })\n          break\n      }\n    },\n    handleSuccess () {\n      const _this = this\n      console.log(this.currentSetSts)\n      switch (this.currentSetSts) {\n        case 'add':\n        case 'edit': //  添加\n        console.log(_this.form)\n        this.$refs.form.validate((valid) => {\n          if (valid) {\n            this.fullscreenLoading = true\n            if (this.isuploadImg === false) { //  判断是否重新上传了图片\n              this.postadd()\n            } else {\n              let para = new URLSearchParams(_this.form)\n              qiniuupload(para).then(res => {\n                console.log(res)\n                let { code, data, url } = res\n                if (code === 200) {\n                  this.form.img = ''\n                  let { key, hash } = data\n                  console.log(key, hash)\n                  _this.form.img = url + key\n                  this.postadd()\n                }\n              })\n            }\n          } else {\n            this.$message.error('请填写完整')\n            return false\n          }\n        })\n          break\n        case 'preview':\n          this.dialogCfg.dialogVisible = false\n          break\n       }\n    },\n    handleChange (file) {\n      const _this = this\n      this.imageUrl = URL.createObjectURL(file.raw) // 图片预览\n      let reader = new FileReader() //  生成文件读取\n      reader.readAsDataURL(file.raw) //  转化文件数据流链接\n      reader.onload = function () {\n        _this.isuploadImg = true\n        _this.form.img = reader.result //  拿到base64结果\n      }\n    },\n    postadd () {\n      if (this.form._id) { //  编辑\n      } else {\n        this.form.createDate = new Date().getTime()\n      }\n      this.form.updateTime = new Date().getTime()\n      let para = new URLSearchParams(this.form)\n      taskadd(para).then(res => {\n        console.log(res)\n        let { code, msg } = res\n        if (code === 200) {\n          this.fullscreenLoading = false\n          this.$message.success(msg)\n          this.getlist()\n          this.dialogCfg.dialogVisible = false\n          // this.$confirm('添加成功,是否继续添加?', '提示', {\n          //   confirmButtonText: '继续',\n          //   cancelButtonText: '取消',\n          //   type: 'primary'\n          // }).then(() => {\n          //   this.form.name = ''\n          // }).catch(() => {\n          //   this.$message.success(msg)\n          //   this.getlist()\n          //   this.dialogCfg.dialogVisible = false\n          // })\n        } else {\n          this.fullscreenLoading = false\n          this.$message.error(msg)\n        }\n      })\n    },\n    getTime(time) {\n      if (time) {\n        return utils.formatterTime(parseInt(time))\n      }\n      return ''\n    },\n  },\n\n}\n</script>\n<style lang=\"stylus\" scoped>\n.avatar-uploader .el-upload {\n  border: 1px dashed #d9d9d9;\n  border-radius: 6px;\n  cursor: pointer;\n  position: relative;\n  overflow: hidden;\n}\n.avatar-uploader .el-upload:hover {\n  border-color: #409EFF;\n}\n.avatar-uploader-icon {\n  font-size: 28px;\n  color: #8c939d;\n  width: 100px;\n  height: 100px;\n  border: 1px solid #ccc\n  line-height: 100px;\n  text-align: center;\n}\n.avatar {\n  width: 100px;\n  height: 100px;\n  line-height: 100px;\n  display: block;\n}\n.headimg {\n  width 20px\n  height 20px\n}\n.previewImg {\n  display: inherit \n  margin  0 auto\n  width 100%\n}\n</style>\n"],"sourceRoot":"src/views"}]}